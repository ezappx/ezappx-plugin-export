<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>GrapesJS Plugin Boilerplate</title>
  <link href="http://cdn.ezappx.com/css/grapes.min.css" rel="stylesheet">
  <link href="http://cdn.ezappx.com/css/bootstrap.min.css" rel="stylesheet">

  <script src="http://cdn.ezappx.com/js/grapes.js"></script>
  <script src="http://cdn.ezappx.com/js/jquery-3.3.1.min.js"></script>
  <script src="http://cdn.ezappx.com/js/popper.min.js"></script>
  <script src="http://cdn.ezappx.com/js/bootstrap.min.js"></script>
  <script src="http://cdn.ezappx.com/js/grapesjs-blocks-basic.min.js"></script>
  <script src="dist/ezapp-plugin-export.min.js"></script>
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
    }
  </style>
</head>

<body>

  <div id="gjs" style="height:0px; overflow:hidden"></div>
  <div id="tip"></div>
  
  <script type="text/javascript">
    let editor = grapesjs.init({
      height: '100%',
      showOffsets: 1,
      noticeOnUnload: 0,
      storageManager: { autoload: true },
      container: '#gjs',
      fromElement: true,
      canvas: {
        scripts: ['http://cdn.ezappx.com/js/jquery-3.3.1.min.js'],
        styles: ['http://cdn.ezappx.com/css/weui.min.css']
      },

      plugins: ['ezapp-plugin-export', 'gjs-blocks-basic'],
      pluginsOpts: {
        'ezapp-plugin-export': {
          tipDivId: 'tip',
          username: 'test-user',
          projectName: 'test-project',
          uploadApi: '/upload/projectFile',
          exportApi: '/export/mobileAppProject'
        }
      },
    });

    let deviceManager = editor.DeviceManager;

    deviceManager.add('Android', '300px', {
      height: '600px',
      width: '300px'
    });
    editor.setDevice('Android')

    window.editor = editor;
    editor.Commands.add('canvas-clear', function () {
      if (confirm('确认清除画布?')) {
        editor.DomComponents.clear();
        setTimeout(function () {
          localStorage.clear()
        }, 0)
      }
    });

    let pn = editor.Panels;
    pn.addButton('options', {
      id: 'clean-canvas',
      className: 'fa fa-trash',
      command: function () {
        editor.runCommand('canvas-clear')
      },
      attributes: {
        'title': '清空画布',
        'data-tooltip-pos': 'bottom',
      },
    });
  </script>
</body>

</html>